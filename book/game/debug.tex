\secrel{Отладка под эмулятором}\label{qemudebug}

QEMU обеспечивает не только запуск \term{bare metal} программ в эмулиремой
виртуальной машине, но и полноценный отладочный интерфейс для GNU \file{gdb}.

\lst{game/debug0.mk}{title=\file{/game/Makefile},language=make}

PHONY-цель \file{go}\ идет в \file{Makefile} самой первой, и является главной
целью при запуске \verb|make [go]|. \file{game.elf}\ будет автоматически
перекомпилирован если вы меняли или удаляли какие-то зависимые файлы (с
исходным кодом), затем будет запущен QEMU в режиме \term{отладочного сервера}.
Режимы работы задаются с помощью опций командной строки:

\begin{description}
\item[-kernel game.elf] QEMU умеет загружать напрямую ядра операционных систем и
bare metal программы, в которых есть загрузочный заголовок Multiboot
\ref{multiboot}. Для запуска игр скомпилированных в ELF файлы вам не нужны
образы дисков\ --- все ресурсы игры вкомпилированы внутрь исполняемого
кода, и загрузчик ОС сам позаботится чтобы они были помещены в правильные
области ОЗУ.
\item[-nographic] отключить открытие окна эмулятора видеовывода VGA
\item[-s] включить \term{gdb-сервер}
\item[-S] ожидать подключения отладчика до запуска программы
\end{description}

\begin{framed}\noindent
Умение пользоваться \term{отладчиком}\ --- \emph{критический навык} для
любого разработчика встраиваемых систем. 
\end{framed}
\noindent
Вы это поймете как только соскочите с Одурины \ref{arduino}\ на любую другую
среду разработки для микроконтроллеров. Вместо того чтобы долбить команды
отладочного вывода на UART, через (аппаратный) отладчик вы получаете полноценный
интерактивный доступ ко всем внутренностям микроконтроллера или любой программы,
запущенной под операционной системой.
\note{
Если какой-то великий специалист пытается вам усиленно доказывать, что для
разработки отладчик не нужен, и достаточно UART-команд устройства и отладочного
вывода, поздравляю\ --- вы наняли само\-учку-дяйвайщика. Такой ``специалист''
подобен электронщику который настраивает схему с помощью китайского тестера и
лампочки вместо многоканального осциллографа и логического анализатора. Самое
смешное, что таких инженеров массово выпускают профильные технические кафедры
российских ``ВУЗ''ов, в нагрузку 146\% вы также получаете незнание о
существовании систем контроля версий, документирования кода, багтрекинга,
тестирования, и ведения проектной документации.
}

\lst{game/gdb0.gdb}{title=\file{/game/game.elf.gdb}}
