\secrel{Парсер с использованием библиотеки PLY}\label{ply}

Библиотека PLY позволяет писать \term{парсеры} для достаточно сложных языков.
Несмотря на то что диалекты \F/\pyf\ требуют только реализацию \term{лексера},
есть смысл немного сэкономить усилия, и не заморачиваться с написанием
традиционного посимвольного разбора ``до пробела''. Если вам для какой-то задачи
потребуется применение \term{инфиксного синтаксиса}, типа разбора арифметических
выражений, вы сможете без особых усилий добавить для них \term{синтаксический
анализатор}.

Еще одно достоинство использования PLY: с ее помощью мы можем автоматически
определять тип для каждой лексемы, в частности разпознавать примитивные типы
\ref{prim}\ и вызывать соответствующие конструкторы. В \ref{typeval}\ есть
особая сноска по этому поводу: для совместимости с PLY были специально выбраны
имена переменных типа и значения: \verb|type| и \verb|value|.

\clearpage
\lst{forth/parser.py}{language=Python}

\clearpage
\begin{description}[nosep]
\item[tokens] список токенов, которые может распознавать парсер\\
так как мы специально обеспечили возможность использования фрей\-мов-примитивов
в качестве \term{литералов}, в этом списке должны быть перечислены тэги (c
маленькой буквы)
\item[t\_ignore] символы которые не будут участвовать в разборе (пробелы) 
\item[t\_number()] правило лексера распознающее числа
\item[t\_symbol()] правило распознающее символы как имена форт-слов
\item[t\_error()] обработка синтаксических ошибок: нераспознанные символы
\end{description}

\bigskip
\noindent
Каждое правило лексера задается в виде функции, её docstring задает регулярное
выражение, которому должна удовлетворять группа символов, чтобы быть
распознанной. Функция получает на вход параметр \verb|t| содержащий
\textit{состояние лексера}; \verb|t.value| содержит распознанную группу символов
в виде строки, которую мы возвращаем из функции через вызов конструктора фрейма
соответствующего типа.

\clearpage\noindent
\verb|ply.lex.lex()| проходит по исходному коду текущего модуля \py, находит
функции соответствующие шаблону правил лексера, и синтезирует функцию-лексер.

\medskip
\lst{forth/lexer.py}{language=Python}
