\secrel{Динамическая компиляция}\label{dyna}\secdown

Интерпретаторы часто ругают за медленное выполнение программ и значительное
потребление вычислительных ресурсов\note{процессор и память} на его
функционирование. Вы сами можете это проверить, написан один и тот же
вычислительный алгоритм на \py\note{без использования внешних библиотек}\ и
\cpp, и сравнив скорость и использумый объем ОЗУ. Особенно заметно это будет,
если вы когда-нибудь пытались запускать вычислительные алгоритмы на \metal. К
накладным расходам на работу \py\ вы еще добавляете накладные расходы на очень
высокоуровневую модель языка\ --- даже каждое примитивное числово завернуто во
фрейм, любая элементарная операция типа сложения превращается в елозинье по
памяти. Тем не менее \emph{правильное} использование \metal\ для численных
расчетов вполне имеет шансы \textit{обогнать по скорости работы аналогичный код
на Си}.

Для получения как минимум приемлемой скорости прикладных вычислений в
интерпретаторах уже десятки лет применяется \term{динамическая компиляция}.

В состав интерпретатора входит компилятор, который вызывается явно или
автоматически, отслеживает части кода программ которые не изменяются длительное
время и/или часто выполняются, и компилирует эти куски программы в ОЗУ в
реальный машинный код. Чаще всего такой компиляции подвергаются функции, так
как их можно выделить как самостоятельные компилируемые элементы. 

В результате динамической компиляции одновременно существуют два представления
программы:
\begin{itemize}[nosep]
\item высокоуровневая исполняемая структура данных, и
\item машинный код компьютера, на котором выполняется интерпретатор.
\end{itemize}
В интерпретаторе прописана логика проверки наличия и актуальности версии в
машинном коде, которая в процессе интерпретации вызывает откомпилированный код.
Например такая проверка может быть реализована как специальное поле в
низкоуровневой структуре данных, представляющей функции, хранящее указатель на
машинный код, или нулевой указатель если функция была измененена позже последней
компиляции.

\input{dyna/managed}
\input{dyna/llvm}

\secup
